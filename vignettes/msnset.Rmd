---
title: "Working with MSnSets"
author: "Charlotte Dawson"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: camprot_references.json
vignette: >
  %\VignetteIndexEntry{Working with MSnSets}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, message=FALSE}
library(MSnbase)
library(camprotR)
library(dplyr)
```

## Introduction

**What is an MSnSet?** To quote from `MSnbase`:

> The `MSnSet` class is derived form the `Biobase::eSet` class and mimics the
`Biobase::ExpressionSet` class classically used for microarray data.

This description is a bit dense and unintelligible, so I will describe an MSnSet
in my own words:

1. An MSnSet is a special type of list (specifically it is an S4 object) that 
describes an MS experiment. 
1. This list contains multiple objects of different types (typically a matrix or
data.frame) that contains the quantitative data and metadata from an MS experiment.
1. These underlying objects must have a specific structure (e.g. matching sample 
names and the correct dimensions), so that each individual object in this 
special list can be combined when necessary.

Conveniently, the `MSnbase` package comes with some example MSnSets. In this
section we will explore the `msnset` MSnSet. This data set is from an 
iTRAQ 4-plex experiment wherein BSA and Enolase have been spiked into a background
of _Erwinia_ proteins. See `?msnset` for more information.

## Exploring an MSnSet

Below we make an example list to compare to an MSnSet.

```{r}
# make a list which contains 2 data.frames and a list
ls <- list(
  "df1" = data.frame(
    x = letters[1:3],
    y = 1:3
  ),
  "df2" = data.frame(
    a = rnorm(100),
    b = rnorm(100)
  ),
  "ls1" = list(
    sample.int(100, 10),
    sample.int(200, 10)
  )
)
```

My favourite way to have a look at anything in R is to use the `str()` 
function to explore an objects' structure.

```{r}
# ls is a list of 3 objects
str(ls, max.level = 2)

# msnset is an MSnSet with 9 'slots' that each contain some sort of object
str(msnset, max.level = 2)
```

Each slot in `msnset` is described in detail in section x below. For now we will 
only concern ourselves with the `assayData`, `featureData`,  and `phenoData` slots. 

MSnSets contain information about an MS experiment. To better understand MSnSets
we need to define some terminology.

In a quantitative proteomics experiment we are analysing 'samples' from
different experimental conditions via MS, e.g. comparing 'samples' from cells treated 
with a drug versus a control. The quantitative data we eventually
obtain consists of measurements of 'features'. In this context features can be 
PSMs, peptides, or proteins.

### assayData

The `assayData` slot contains the quantitative data from the experiment, 
i.e. how much of each feature (spectra/PSM, peptide, or protein) was detected 
in each sample. **This is the essential part of an MSnSet.** All other slots 
are optional.

We can extract this information from the MSnSet into a numeric matrix with the 
`exprs()` function.

```{r}
msnset_exprs <- exprs(msnset)
```

Lets look at its structure.

```{r}
str(msnset_exprs)
```

It is a `r nrow(msnset_exprs)` by `r ncol(msnset_exprs)` numeric matrix. 
The data it contains is reporter ion intensities from `r ncol(msnset_exprs)` 
iTRAQ tags across `r nrow(msnset_exprs)` different PSMs.

Each **column** of this matrix refers to an iTRAQ tag which corresponds
to an individual **'sample'**. Each **row** of this matrix corresponds to a 
**'feature'** which in this case is a PSM. The numbers indicate the intensity of
the reporter ion from a particular tag (i.e. sample) in a particular PSM.

### featureData

The `featureData` slot contains metadata about the 'features' (e.g. PSMs, 
peptides, proteins). 

We can extract this information from the MSnSet into a data.frame with the 
`fData()` function.

```{r}
msnset_fdata <- fData(msnset)
```

Lets look at its structure.

```{r}
str(msnset_fdata)
```

It is a `r nrow(msnset_exprs)` by `r ncol(msnset_exprs)` data.frame. The data
it contains is metadata about each 'feature', which are PSMs in this case. 
The type of metadata included is entirely arbitrary and there can be as many
or as few columns as you want.

Each **column** of this matrix refers to a particular type of metadata. 
Each **row** of this matrix corresponds to a **'feature'** which in this case 
is a PSM. Notice that the number of rows in `featureData` must be the same as
the number of rows in `assayData`.

### phenoData

The `phenoData` slot contains metadata about the 'samples'.

We can extract this information from the MSnSet into a data.frame with the 
`pData()` function.

```{r}
msnset_pdata <- pData(msnset)
```

Lets look at its structure.

```{r}
str(msnset_pdata)
```

It is a `r nrow(msnset_exprs)` by `r ncol(msnset_exprs)` data.frame. The data
it contains is metadata about each 'sample', which are iTRAQ tags in this case. 
The type of metadata included is entirely arbitrary and there can be as many
or as few columns as you want.

Each **column** of this matrix refers to a particular type of metadata. 
Each **row** of this matrix corresponds to a **'sample'** which in this case 
is an iTRAQ tag. Notice that the number of rows in `[phenoData` must be the 
same as the number of columns in `assayData`.

## Making an MSnSet

## Extracting results from an MSnSet

## MSnSet slots
